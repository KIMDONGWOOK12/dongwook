(()=>{"use strict";var e={1:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteWSLResolver=t.REMOTE_WSL_AUTHORITY=void 0,t.getRemoteAuthority=function(e){return`${t.REMOTE_WSL_AUTHORITY}+${e}`};const a=s(n(398)),l=n(449);t.REMOTE_WSL_AUTHORITY="wsl";class c{remoteAddress;localAddress;_onDidDisposeEmitter=new a.EventEmitter;onDidDispose=this._onDidDisposeEmitter.event;constructor(e,t){this.remoteAddress=e,this.localAddress=t,"localhost"!==t.host&&"127.0.0.1"!==t.host&&(t.host="localhost")}dispose(){this._onDidDisposeEmitter.fire()}}t.RemoteWSLResolver=class{wslManager;logger;labelFormatterDisposable;constructor(e,t){this.wslManager=e,this.logger=t}resolve(e,n){const[r,o]=e.split("+");if(r!==t.REMOTE_WSL_AUTHORITY)throw new Error(`Invalid authority type for WSL resolver: ${r}`);return this.logger.info(`Resolving wsl remote authority '${e}' (attempt #${n.resolveAttempt})`),a.window.withProgress({title:`Setting up WSL Distro: ${o}`,location:a.ProgressLocation.Notification,cancellable:!1},async()=>{try{const e=await(0,l.installCodeServer)(this.wslManager,o,[],[],this.logger);return this.labelFormatterDisposable?.dispose(),this.labelFormatterDisposable=a.workspace.registerResourceLabelFormatter({scheme:"vscode-remote",authority:`${t.REMOTE_WSL_AUTHORITY}+*`,formatting:{label:"${path}",separator:"/",tildify:!0,workspaceSuffix:`WSL: ${o}`,workspaceTooltip:`Running in ${o}`}}),new a.ResolvedAuthority("127.0.0.1",e.listeningOn,e.connectionToken)}catch(e){if(this.logger.error("Error resolving authority",e),1===n.resolveAttempt){this.logger.show();const e="Close Remote",t="Retry",n=await a.window.showErrorMessage(`Could not establish connection to WSL distro "${o}"`,{modal:!0},e,t);n===e?await a.commands.executeCommand("workbench.action.remote.close"):n===t&&await a.commands.executeCommand("workbench.action.reloadWindow")}throw e instanceof l.ServerInstallError||!(e instanceof Error)?a.RemoteAuthorityResolverError.NotAvailable(e instanceof Error?e.message:String(e)):a.RemoteAuthorityResolverError.TemporarilyNotAvailable(e.message)}})}async tunnelFactory(e){return new c(e.remoteAddress,{host:e.remoteAddress.host,port:e.localAddressPort??e.remoteAddress.port})}dispose(){this.labelFormatterDisposable?.dispose()}}},111:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.DistroTreeDataProvider=void 0;const a=s(n(398)),l=s(n(928)),c=n(193),d=n(187);class u{name;isDefault;locations;constructor(e,t,n){this.name=e,this.isDefault=t,this.locations=n}}class f{path;name;constructor(e,t){this.path=e,this.name=t}}class h extends c.Disposable{locationHistory;wslManager;_onDidChangeTreeData=this._register(new a.EventEmitter);onDidChangeTreeData=this._onDidChangeTreeData.event;constructor(e,t){super(),this.locationHistory=e,this.wslManager=t,this._register(a.commands.registerCommand("antigravityremotewsl.explorer.addDistro",()=>(0,d.promptInstallNewWSLDistro)(t))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.refresh",()=>this.refresh())),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.emptyWindowInNewWindow",e=>this.openRemoteWSLWindow(e,!1))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.emptyWindowInCurrentWindow",e=>this.openRemoteWSLWindow(e,!0))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.reopenFolderInNewWindow",e=>this.openRemoteWSLocationWindow(e,!1))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.reopenFolderInCurrentWindow",e=>this.openRemoteWSLocationWindow(e,!0))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.deleteFolderHistoryItem",e=>this.deleteDistroLocation(e))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.setDefaultDistro",e=>this.setDefaultDistro(e))),this._register(a.commands.registerCommand("antigravityremotewsl.explorer.deleteDistro",e=>this.deleteDistro(e)))}getTreeItem(e){if(e instanceof f){const t=l.posix.basename(e.path).replace(/\.code-workspace$/," (Workspace)"),n=new a.TreeItem(t);return n.description=l.posix.dirname(e.path),n.iconPath=new a.ThemeIcon("folder"),n.contextValue="antigravityremotewsl.explorer.folder",n}const t=new a.TreeItem(e.name);return t.description=e.isDefault?"default distro":void 0,t.collapsibleState=e.locations.length?a.TreeItemCollapsibleState.Collapsed:a.TreeItemCollapsibleState.None,t.iconPath=new a.ThemeIcon("vm"),t.contextValue="antigravityremotewsl.explorer.distro",t}async getChildren(e){return e?e instanceof u?e.locations.map(t=>new f(t,e.name)):[]:(await this.wslManager.listDistros()).map(e=>new u(e.name,e.isDefault,this.locationHistory.getHistory(e.name)))}refresh(){this._onDidChangeTreeData.fire()}async deleteDistroLocation(e){await this.locationHistory.removeLocation(e.name,e.path),this.refresh()}async openRemoteWSLWindow(e,t){(0,d.openRemoteWSLWindow)(e.name,t)}async openRemoteWSLocationWindow(e,t){(0,d.openRemoteWSLLocationWindow)(e.name,e.path,t)}async setDefaultDistro(e){await(0,d.setDefaultWSLDistro)(this.wslManager,e.name),this.refresh()}async deleteDistro(e){await(0,d.deleteWSLDistro)(this.wslManager,e.name),this.refresh()}}t.DistroTreeDataProvider=h},144:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){if(!_.isWindows)return;const t=new c.default("Remote - WSL");e.subscriptions.push(t);const n=new p.WSLManager(t),r=new d.RemoteWSLResolver(n,t);e.subscriptions.push(l.workspace.registerRemoteAuthorityResolver(d.REMOTE_WSL_AUTHORITY,r)),e.subscriptions.push(r);const o=new h.RemoteLocationHistory(e),i=(0,h.getRemoteWorkspaceLocationData)();i&&await o.addLocation(i[0],i[1]);const s=new f.DistroTreeDataProvider(o,n);e.subscriptions.push(s),e.subscriptions.push(l.window.createTreeView("antigravityWslTargets",{treeDataProvider:s})),e.subscriptions.push(l.commands.registerCommand("antigravityremotewsl.connect",()=>(0,u.promptOpenRemoteWSLWindow)(n,!0,!0))),e.subscriptions.push(l.commands.registerCommand("antigravityremotewsl.connectInNewWindow",()=>(0,u.promptOpenRemoteWSLWindow)(n,!0,!1))),e.subscriptions.push(l.commands.registerCommand("antigravityremotewsl.connectUsingDistro",()=>(0,u.promptOpenRemoteWSLWindow)(n,!1,!0))),e.subscriptions.push(l.commands.registerCommand("antigravityremotewsl.connectUsingDistroInNewWindow",()=>(0,u.promptOpenRemoteWSLWindow)(n,!1,!1))),e.subscriptions.push(l.commands.registerCommand("antigravityremotewsl.showLog",()=>t.show()))},t.deactivate=function(){};const l=s(n(398)),c=a(n(571)),d=n(1),u=n(187),f=n(111),h=n(394),p=n(707),_=n(540)},187:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.promptOpenRemoteWSLWindow=async function(e,t,n){let r;if(t){const t=await e.listDistros();r=t.find(e=>e.isDefault)?.name}else r=(await async function(e){const t=e.listDistros().then(e=>e.map(e=>({...e,label:`${e.name}`,detail:e.isDefault?"default distro":void 0})));return await l.window.showQuickPick(t,{canPickMany:!1,placeHolder:"Select WSL distro"})}(e))?.name;r&&u(r,n)},t.promptInstallNewWSLDistro=async function(e){const t=(await async function(e){const t=Promise.all([e.listOnlineDistros(),e.listDistros()]).then(([e,t])=>e.filter(e=>!t.some(t=>t.name===e.name)).map(e=>({...e,label:`${e.friendlyName}`})));return await l.window.showQuickPick(t,{canPickMany:!1,placeHolder:"Select the WSL distro to install"})}(e))?.name;t&&d.default.runCommand(`wsl.exe --install -d ${t}`)},t.openRemoteWSLWindow=u,t.openRemoteWSLLocationWindow=function(e,t,n){l.commands.executeCommand("vscode.openFolder",l.Uri.from({scheme:"vscode-remote",authority:(0,c.getRemoteAuthority)(e),path:t}),{forceNewWindow:!n})},t.setDefaultWSLDistro=async function(e,t){await e.setDefaultDistro(t)},t.deleteWSLDistro=async function(e,t){const n="Delete";return await l.window.showInformationMessage(`Are you sure you want to permanently delete the distro "${t}" including all its data?`,{modal:!0},n)===n&&(await e.deleteDistro(t),!0)};const l=s(n(398)),c=n(1),d=a(n(862));function u(e,t){l.commands.executeCommand("vscode.newWindow",{remoteAuthority:(0,c.getRemoteAuthority)(e),reuseWindow:t})}},193:(e,t)=>{function n(e){for(;e.length;){const t=e.pop();t&&t.dispose()}}Object.defineProperty(t,"__esModule",{value:!0}),t.Disposable=void 0,t.disposeAll=n,t.Disposable=class{_isDisposed=!1;_disposables=[];dispose(){this._isDisposed||(this._isDisposed=!0,n(this._disposables))}_register(e){return this._isDisposed?e.dispose():this._disposables.push(e),e}get isDisposed(){return this._isDisposed}}},317:e=>{e.exports=require("child_process")},394:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteLocationHistory=void 0,t.getRemoteWorkspaceLocationData=function(){let e=a.workspace.workspaceFile;if(e&&"vscode-remote"===e.scheme&&e.authority.startsWith(l.REMOTE_WSL_AUTHORITY)&&e.path.endsWith(".code-workspace")){const[,t]=e.authority.split("+");return[t,e.path]}if(e=a.workspace.workspaceFolders?.[0].uri,e&&"vscode-remote"===e.scheme&&e.authority.startsWith(l.REMOTE_WSL_AUTHORITY)){const[,t]=e.authority.split("+");return[t,e.path]}};const a=s(n(398)),l=n(1);class c{context;static STORAGE_KEY="remoteLocationHistory_v0";remoteLocationHistory={};constructor(e){this.context=e,this.remoteLocationHistory=e.globalState.get(c.STORAGE_KEY)||{}}getHistory(e){return this.remoteLocationHistory[e]||[]}async addLocation(e,t){const n=this.remoteLocationHistory[e]||[];n.includes(t)||(n.unshift(t),this.remoteLocationHistory[e]=n,await this.context.globalState.update(c.STORAGE_KEY,this.remoteLocationHistory))}async removeLocation(e,t){let n=this.remoteLocationHistory[e]||[];n=n.filter(e=>e!==t),this.remoteLocationHistory[e]=n,await this.context.globalState.update(c.STORAGE_KEY,this.remoteLocationHistory)}}t.RemoteLocationHistory=c},398:e=>{e.exports=require("vscode")},449:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.ServerInstallError=void 0,t.installCodeServer=async function(e,t,n,r,o){const i=a.randomBytes(12).toString("hex"),s=await(0,l.getVSCodeServerConfig)(),u=String(a.randomInt(4294967295)),f=d({id:i,vscodeVersion:s.vscodeVersion,ideVersion:s.ideVersion,commit:s.commit,quality:s.quality,release:s.release,extensionIds:n,envVariables:r,serverApplicationName:s.serverApplicationName,serverDataFolderName:s.serverDataFolderName},u);o.trace("Running server install script");const h=await e.exec("bash",["-c",`'${f.replace(/'/g,"'\\''")}'`],t);o.trace("Passed server install script");const p=new RegExp(`${i}: Server installation script done`,"m"),_=await Promise.race([h.exitPromise.then(e=>({stdout:h.stdout,stderr:h.stderr,exitCode:e.exitCode})),new Promise(e=>{h.onStdoutData(t=>{p.test(t.toString("utf8"))&&e({stdout:h.stdout,stderr:h.stderr,exitCode:0})})})]);_.exitCode&&o.trace("Server install command stderr:",_.stderr),o.trace("Server install command stdout:",_.stdout);const m=function(e,t){const n=`${t}: start`,r=`${t}: end`,o=e.indexOf(n);if(o<0)return;const i=e.indexOf(r,o+n.length);if(i<0)return;const s={},a=e.substring(o+n.length,i).split(/\r?\n/);for(const e of a){const[t,n]=e.split("==");s[t]=n}return s}(_.stdout,i);if(!m)throw new c("Failed parsing install script output");const E=parseInt(m.exitCode,10);if(0!==E)throw new c("Couldn't install vscode server on remote server, install script returned non-zero exit status");const R=parseInt(m.listeningOn,10);o.trace(`Listening on port ${R}`);const g=Object.fromEntries(Object.entries(m).filter(([e])=>r.includes(e)));return{exitCode:E,listeningOn:R,connectionToken:m.connectionToken,logFile:m.logFile,osReleaseId:m.osReleaseId,arch:m.arch,platform:m.platform,tmpDir:m.tmpDir,...g}},t.generateBashInstallScript=d;const a=s(n(982)),l=n(724);class c extends Error{constructor(e){super(e)}}function d({id:e,quality:t,vscodeVersion:n,ideVersion:r,commit:o,release:i,extensionIds:s,envVariables:a,serverApplicationName:l,serverDataFolderName:c},d){const u=s.map(e=>"--install-extension "+e).join(" ");return`\n# Server installation script\n\nTMP_DIR="\${XDG_RUNTIME_DIR:-"/tmp"}"\n\nDISTRO_VSCODE_VERSION="${n}"\nDISTRO_IDE_VERSION="${r}"\nDISTRO_COMMIT="${o}"\nDISTRO_QUALITY="${t}"\nDISTRO_VSCODIUM_RELEASE="${i??""}"\n\nSERVER_APP_NAME="${l}"\nSERVER_INITIAL_EXTENSIONS="${u}"\nSERVER_LISTEN_FLAG="--port=0"\nSERVER_DATA_DIR="$HOME/${c}"\nSERVER_DIR="$SERVER_DATA_DIR/bin/$DISTRO_IDE_VERSION-$DISTRO_COMMIT"\nSERVER_SCRIPT="$SERVER_DIR/bin/$SERVER_APP_NAME"\nSERVER_LOGFILE="$SERVER_DATA_DIR/.$DISTRO_COMMIT.log"\nSERVER_PIDFILE="$SERVER_DATA_DIR/.$DISTRO_COMMIT.pid"\nSERVER_TOKENFILE="$SERVER_DATA_DIR/.$DISTRO_COMMIT.token"\nSERVER_ARCH=\nSERVER_CONNECTION_TOKEN=\nSERVER_DOWNLOAD_URL=\n\nLISTENING_ON=\nOS_RELEASE_ID=\nARCH=\nPLATFORM=\nSERVER_PID=\n\nGLIBC_VERSION_GOOD=\n\n# Add lock mechanism\nLOCK_FILE="$SERVER_DATA_DIR/.installation_lock"\n\n# Function to acquire lock\nacquire_lock() {\n\texec 200>$LOCK_FILE\n\techo "Waiting for lock..."\n\tflock 200\n\techo "Lock acquired, proceeding with installation."\n}\n\n# Function to release lock\nrelease_lock() {\n\tflock -u 200\n\texec 200>&-\n}\n\n# Mimic output from logs of remote-ssh extension\nprint_install_results_and_exit() {\n\tif [[ $1 -eq 1 ]]; then\n\t\techo ""\n\t\techo "Error: installation failed."\n\t\tif [[ -f "$SERVER_LOGFILE" ]]; then\n\t\t\techo "Server log:\n $(cat "$SERVER_LOGFILE")\n"\n\t\tfi\n\tfi\n\tif [[ "$GLIBC_VERSION_GOOD" = "false" ]]; then\n\t\techo "Warning: valid glibc version not found. Antigravity only supports remote connections with glibc >= 2.28, such as Ubuntu 20.04, Debian 10, or CentOS 8."\n\t\techo ""\n\tfi\n\techo "${e}: start"\n\techo "exitCode==$1=="\n\techo "listeningOn==$LISTENING_ON=="\n\techo "connectionToken==$SERVER_CONNECTION_TOKEN=="\n\techo "logFile==$SERVER_LOGFILE=="\n\techo "osReleaseId==$OS_RELEASE_ID=="\n\techo "arch==$ARCH=="\n\techo "platform==$PLATFORM=="\n\techo "tmpDir==$TMP_DIR=="\n\t${a.map(e=>`echo "${e}==$${e}=="`).join("\n")}\n\techo "${e}: end"\n\n\texit 0\n}\n\n# Check if platform is supported\nKERNEL="$(uname -s)"\ncase $KERNEL in\n\tLinux)\n\t\tPLATFORM="linux"\n\t\t;;\n\t*)\n\t\techo "Error platform not supported: $KERNEL"\n\t\tprint_install_results_and_exit 1\n\t\t;;\nesac\n\n# Check machine architecture\nARCH="$(uname -m)"\ncase $ARCH in\n\tx86_64 | amd64)\n\t\tSERVER_ARCH="x64"\n\t\t;;\n\tarm64 | aarch64)\n\t\tSERVER_ARCH="arm64"\n\t\t;;\n\t*)\n\t\techo "Error architecture not supported: $ARCH"\n\t\tprint_install_results_and_exit 1\n\t\t;;\nesac\n\n# https://www.freedesktop.org/software/systemd/man/os-release.html\nOS_RELEASE_ID="$(grep -i '^ID=' /etc/os-release 2>/dev/null | sed 's/^ID=//gi' | sed 's/"//g')"\nif [[ -z $OS_RELEASE_ID ]]; then\n\tOS_RELEASE_ID="$(grep -i '^ID=' /usr/lib/os-release 2>/dev/null | sed 's/^ID=//gi' | sed 's/"//g')"\n\tif [[ -z $OS_RELEASE_ID ]]; then\n\t\tOS_RELEASE_ID="unknown"\n\tfi\nfi\n\n# Create installation folder\nif [[ ! -d $SERVER_DIR ]]; then\n\tmkdir -p $SERVER_DIR\n\tif (( $? > 0 )); then\n\t\techo "Error creating server install directory"\n\t\tprint_install_results_and_exit 1\n\tfi\nfi\n\n# Acquire lock at the beginning of the script\nacquire_lock\n\n# Add trap to release lock on exit\ntrap release_lock EXIT INT TERM\n\nif [[ "$SERVER_ARCH" == "arm64" ]]; then\n\tSERVER_ARCH="arm"\nfi\nif [[ "$DISTRO_QUALITY" == "insider" ]]; then\n\tSERVER_DOWNLOAD_URL="$DISTRO_QUALITY/$DISTRO_IDE_VERSION-$DISTRO_COMMIT/$PLATFORM-$SERVER_ARCH/Antigravity - Insiders-reh.tar.gz"\nelse\n\tSERVER_DOWNLOAD_URL="$DISTRO_QUALITY/$DISTRO_IDE_VERSION-$DISTRO_COMMIT/$PLATFORM-$SERVER_ARCH/Antigravity-reh.tar.gz"\nfi\n\nif [[ "$PLATFORM" == "linux" ]]; then\n\t# Check ldd version based on format "ldd (.*) 2.28"\n\tversion=$(ldd --version | head -n 1 | grep -oE '[0-9]+.[0-9]+$')\n\tif (( $? > 0 )); then\n\t\techo "Warning: ldd not found"\n\t\tGLIBC_VERSION_GOOD="false"\n\telse\n\t\tmajor=$(echo "$version" | cut -d '.' -f 1)\n\t\tminor=$(echo "$version" | cut -d '.' -f 2)\n\n\t\tif [[ "$major" -eq 2 && "$minor" -ge 28 ]]; then\n\t\t\tGLIBC_VERSION_GOOD="true"\n\t\telse\n\t\t\tGLIBC_VERSION_GOOD="false"\n\t\tfi\n\tfi\n\n\tif [[ "$GLIBC_VERSION_GOOD" = "false" ]]; then\n\t\techo "Warning: valid glibc version not found. Antigravity only supports remote connections with glibc >= 2.28, such as Ubuntu 20.04, Debian 10, or CentOS 8."\n\tfi\nfi\n\n# Check if server script is already installed\nif [[ ! -f $SERVER_SCRIPT ]]; then\n\tpushd $SERVER_DIR > /dev/null\n\n\ttemp_file=$(mktemp)\n\n\tDOWNLOAD_URLS=(\n\t\t"https://edgedl.me.gvt1.com/edgedl/release2/j0qc3/antigravity/$SERVER_DOWNLOAD_URL"\n\t\t"https://redirector.gvt1.com/edgedl/release2/j0qc3/antigravity/$SERVER_DOWNLOAD_URL"\n\t\t"https://edgedl.me.gvt1.com/edgedl/antigravity/$SERVER_DOWNLOAD_URL"\n\t\t"https://redirector.gvt1.com/edgedl/antigravity/$SERVER_DOWNLOAD_URL"\n\t)\n\n\tdownload_success=0\n\tfor url in "\${DOWNLOAD_URLS[@]}"; do\n\t\tif [ ! -z $(which wget) ]; then\n\t\t\twget --tries=3 --timeout=10 --continue --quiet -O $temp_file "$url"\n\t\telse\n\t\t\techo "Error need wget to download server binary"\n\t\t\tprint_install_results_and_exit 1\n\t\tfi\n\n\t\tif (( $? == 0 )); then\n\t\t\tdownload_success=1\n\t\t\tbreak\n\t\telse\n\t\t\techo "Download failed from $url, trying next URL..."\n\t\tfi\n\tdone\n\n\tif (( download_success == 0 )); then\n\t\techo "Error downloading server from all URLs"\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\tmv $temp_file vscode-server.tar.gz\n\n\ttar -xf vscode-server.tar.gz --strip-components 1\n\tif (( $? > 0 )); then\n\t\techo "Error while extracting server contents"\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\tif [[ ! -f $SERVER_SCRIPT ]]; then\n\t\techo "Error server contents are corrupted"\n\t\tprint_install_results_and_exit 1\n\tfi\n\n\trm -f vscode-server.tar.gz\n\n\tpopd > /dev/null\nelse\n\techo "Server script already installed in $SERVER_SCRIPT"\nfi\n\n# Try to find if server is already running\nif [[ -f $SERVER_PIDFILE ]]; then\n\tSERVER_PID="$(cat $SERVER_PIDFILE)"\n\tSERVER_RUNNING_PROCESS="$(ps -o pid,args -p $SERVER_PID | grep $SERVER_SCRIPT)"\nelse\n\tSERVER_RUNNING_PROCESS="$(ps -o pid,args -A | grep $SERVER_SCRIPT | grep -v grep)"\n\tif [[ -z $SERVER_RUNNING_PROCESS ]]; then\n\t\tSERVER_PID=\n\telse\n\t\tSERVER_PID="$(echo $SERVER_RUNNING_PROCESS | cut -d ' ' -f 1 | head -n 1)"\n\tfi\nfi\n\nif [[ -z $SERVER_RUNNING_PROCESS ]]; then\n\tif [[ -f $SERVER_LOGFILE ]]; then\n\t\trm $SERVER_LOGFILE\n\tfi\n\tif [[ -f $SERVER_TOKENFILE ]]; then\n\t\trm $SERVER_TOKENFILE\n\tfi\n\n\ttouch $SERVER_TOKENFILE\n\tchmod 600 $SERVER_TOKENFILE\n\tSERVER_CONNECTION_TOKEN="${d}"\n\techo $SERVER_CONNECTION_TOKEN > $SERVER_TOKENFILE\n\n\t$SERVER_SCRIPT --start-server --host=127.0.0.1 $SERVER_LISTEN_FLAG $SERVER_INITIAL_EXTENSIONS --connection-token-file $SERVER_TOKENFILE --telemetry-level off --use-host-proxy --disable-websocket-compression --without-browser-env-var --enable-remote-auto-shutdown --accept-server-license-terms &> $SERVER_LOGFILE &\n\techo $! > $SERVER_PIDFILE\nelse\n\techo "Server script is already running $SERVER_SCRIPT"\nfi\n\nif [[ -f $SERVER_TOKENFILE ]]; then\n\tSERVER_CONNECTION_TOKEN="$(cat $SERVER_TOKENFILE)"\nelse\n\techo "Error server token file not found $SERVER_TOKENFILE"\n\tprint_install_results_and_exit 1\nfi\n\nif [[ -f $SERVER_LOGFILE ]]; then\n\tfor i in {1..5}; do\n\t\tLISTENING_ON="$(cat $SERVER_LOGFILE | grep -E 'Extension host agent listening on .+' | sed 's/Extension host agent listening on //')"\n\t\tif [[ -n $LISTENING_ON ]]; then\n\t\t\tbreak\n\tfi\n\t\tsleep 0.5\n\tdone\n\n\tif [[ -z $LISTENING_ON ]]; then\n\t\techo "Error server did not start sucessfully"\n\t\tprint_install_results_and_exit 1\n\tfi\nelse\n\techo "Error server log file not found $SERVER_LOGFILE"\n\tprint_install_results_and_exit 1\nfi\n\n# Finish server setup and keep script running\nif [[ -z $SERVER_RUNNING_PROCESS ]]; then\n\techo "${e}: start"\n\techo "exitCode==0=="\n\techo "listeningOn==$LISTENING_ON=="\n\techo "connectionToken==$SERVER_CONNECTION_TOKEN=="\n\techo "logFile==$SERVER_LOGFILE=="\n\techo "osReleaseId==$OS_RELEASE_ID=="\n\techo "arch==$ARCH=="\n\techo "platform==$PLATFORM=="\n\techo "tmpDir==$TMP_DIR=="\n\t${a.map(e=>`echo "${e}==$${e}=="`).join("\n")}\n\techo "${e}: end"\n\n\techo "${e}: Server installation script done"\n\n\tSERVER_PID="$(cat $SERVER_PIDFILE)"\n\tSERVER_RUNNING_PROCESS="$(ps -o pid,args -p $SERVER_PID | grep $SERVER_SCRIPT)"\n\n\trelease_lock\n\n\twhile [[ -n $SERVER_RUNNING_PROCESS ]]; do\n\t\tsleep 300;\n\t\tSERVER_RUNNING_PROCESS="$(ps -o pid,args -p $SERVER_PID | grep $SERVER_SCRIPT)"\n\tdone\nelse\n\tprint_install_results_and_exit 0\nfi\n`}t.ServerInstallError=c},540:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isLinux=t.isMacintosh=t.isWindows=void 0,t.isWindows="win32"===process.platform,t.isMacintosh="darwin"===process.platform,t.isLinux="linux"===process.platform},571:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const a=s(n(398));function l(e,t,n=" "){return n.repeat(Math.max(0,t-e.length))+e}t.default=class{output;constructor(e){this.output=a.window.createOutputChannel(e)}data2String(e){return e instanceof Error?e.stack||e.message:!1===e.success&&e.message?e.message:e.toString()}trace(e,t){this.logLevel("Trace",e,t)}info(e,t){this.logLevel("Info",e,t)}error(e,t){this.logLevel("Error",e,t)}logLevel(e,t,n){this.output.appendLine(`[${e}  - ${this.now()}] ${t}`),n&&this.output.appendLine(this.data2String(n))}now(){const e=new Date;return l(e.getUTCHours()+"",2,"0")+":"+l(e.getMinutes()+"",2,"0")+":"+l(e.getUTCSeconds()+"",2,"0")+"."+e.getMilliseconds()}show(){this.output.show()}dispose(){this.output.dispose()}}},707:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.WSLManager=void 0;const a=s(n(317)),l=n(867),c="wsl.exe";t.WSLManager=class{logger;constructor(e){this.logger=e}async listDistros(){const e=this._runWSLCommand(["--list","--verbose"],"utf16le"),{exitCode:t}=await e.exitPromise,{stdout:n,stderr:r}=e;if(t)throw this.logger.trace(`Command wsl listDistros exited with code ${t}`,n+"\n\n"+r),new Error(`Command wsl listDistros exited with code ${t}`);const o=/(?<default>\*|\s)\s+(?<name>[\w\.-]+)\s+(?<state>[\w]+)\s+(?<version>\d)/,i=[];for(const e of n.split(/\r?\n/)){const t=e.match(o);t&&t.groups&&i.push({isDefault:"*"===t.groups.default,name:t.groups.name,state:t.groups.state,version:t.groups.version})}return i}async listOnlineDistros(){const e=this._runWSLCommand(["--list","--online"],"utf16le"),{exitCode:t}=await e.exitPromise,{stdout:n,stderr:r}=e;if(t)throw this.logger.trace(`Command wsl listOnlineDistros exited with code ${t}`,n+"\n\n"+r),new Error(`Command wsl listOnlineDistros exited with code ${t}`);let o=n.split(/\r?\n/);const i=o.findIndex(e=>/\s*NAME\s+FRIENDLY NAME\s*/.test(e));o=o.slice(i+1);const s=/(?<name>[\w\.-]+)\s+(?<friendlyName>\w.+\w)/,a=[];for(const e of o){const t=e.match(s);t&&t.groups&&a.push({name:t.groups.name,friendlyName:t.groups.friendlyName})}return a}async setDefaultDistro(e){const t=this._runWSLCommand(["--set-default",e],"utf16le"),{exitCode:n}=await t.exitPromise,{stdout:r,stderr:o}=t;if(n)throw this.logger.trace(`Command wsl setDefaultDistro exited with code ${n}`,r+"\n\n"+o),new Error(`Command wsl setDefaultDistro exited with code ${n}`)}async deleteDistro(e){const t=this._runWSLCommand(["--unregister",e],"utf16le"),{exitCode:n}=await t.exitPromise,{stdout:r,stderr:o}=t;if(n)throw this.logger.trace(`Command wsl deleteDistro exited with code ${n}`,r+"\n\n"+o),new Error(`Command wsl deleteDistro exited with code ${n}`)}async exec(e,t,n){return this._runWSLCommand(["--distribution",n,"--",e,...t],"utf8")}_runWSLCommand(e,t){this.logger.trace(`Running WSL command: ${c} ${e.join(" ")}`);const n=a.spawn(c,e,{windowsHide:!0,windowsVerbatimArguments:!0}),r=new l.EventEmitter,o=[],i=new l.EventEmitter,s=[];n.stdout.on("data",e=>{o.push(e),r.fire(e)}),n.stderr.on("data",e=>{s.push(e),i.fire(e)});const d=new Promise((t,r)=>{n.on("error",t=>{this.logger.error(`Error running WSL command: ${c} ${e.join(" ")}`,t),r(t)}),n.on("exit",(e,n)=>{t({exitCode:e??0})})});return{get stdout(){return Buffer.concat(o).toString(t)},get stderr(){return Buffer.concat(s).toString(t)},get onStdoutData(){return r.event},get onStderrData(){return i.event},exitPromise:d}}}},724:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.getVSCodeServerConfig=async function(){const e=await async function(){if(!d){const e=await l.promises.readFile(c.join(a.env.appRoot,"product.json"),"utf8");d=JSON.parse(e)}return d}(),t=a.version.replace("-insider","");let n=e.ideVersion,r=e.commit,o=e.quality,i=e.serverApplicationName,s=e.serverDataFolderName;if("dev"===o){const e=await fetch(u),t=await e.json();n=t.ideVersion,r=t.version,o="insider",i="antigravity-server-insiders",s=".antigravity-server-insiders"}return{vscodeVersion:t,ideVersion:n,commit:r,quality:o,release:e.release,serverApplicationName:i,serverDataFolderName:s,serverDownloadUrlTemplate:e.serverDownloadUrlTemplate}};const a=s(n(398)),l=s(n(896)),c=s(n(928));let d;const u=""},862:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0});const a=s(n(398));class l{static NAME="WSL";getTerminal(){return a.window.terminals.find(e=>e.name===l.NAME)||a.window.createTerminal(l.NAME)}runCommand(e){const t=this.getTerminal();t.show(!1),t.sendText(e,!0)}}t.default=new l},867:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=t.once=void 0,t.toPromise=function(e,n){return n?n.aborted?Promise.resolve(void 0):new Promise(r=>{const o=(0,t.once)(e,e=>{n.removeEventListener("abort",i),r(e)}),i=()=>{o.dispose(),n.removeEventListener("abort",i),r(void 0)};n.addEventListener("abort",i)}):new Promise(n=>(0,t.once)(e,n))},t.once=(e,t)=>{const n=e(e=>{t(e),n.dispose()});return n},t.EventEmitter=class{listeners;event=(e,t,n)=>{const r=this.add(t?e.bind(t):e);return n?.push(r),r};get size(){return this.listeners?"function"==typeof this.listeners?1:this.listeners.length:0}fire(e){if(this.listeners)if("function"==typeof this.listeners)this.listeners(e);else for(const t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?"function"==typeof this.listeners?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if("function"==typeof this.listeners)return void(this.listeners===e&&(this.listeners=void 0));const t=this.listeners.indexOf(e);-1!==t&&(2===this.listeners.length?this.listeners=0===t?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}}},896:e=>{e.exports=require("fs")},928:e=>{e.exports=require("path")},982:e=>{e.exports=require("crypto")}},t={},n=function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(144),r=exports;for(var o in n)r[o]=n[o];n.__esModule&&Object.defineProperty(r,"__esModule",{value:!0})})();
//# sourceMappingURL=https://main.vscode-cdn.net/sourcemaps/d2597a5c475647ed306b22de1e39853c7812d07d/extensions/antigravity-remote-wsl/dist/extension.js.map